<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ma-meteo | Carte Interactive</title>
  
  <!-- Leaflet pour la carte -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      min-height: 100vh;
    }
    
    /* Header avec recherche */
    .header {
      background: rgba(0,0,0,0.3);
      padding: 15px;
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .search-box {
      flex: 1;
      background: rgba(255,255,255,0.2);
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      color: white;
      font-size: 16px;
    }
    
    .search-box::placeholder { color: rgba(255,255,255,0.7); }
    
    .btn-location {
      background: #4CAF50;
      border: none;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
    }
    
    /* Layout principal : carte + panneau */
    .container {
      display: grid;
      grid-template-columns: 1fr 350px;
      height: calc(100vh - 80px);
    }
    
    /* Carte interactive */
    #map {
      height: 100%;
      background: #333;
    }
    
    /* Panneau lat√©ral m√©t√©o */
    .weather-panel {
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(20px);
      padding: 25px;
      overflow-y: auto;
    }
    
    .city-name {
      font-size: 32px;
      font-weight: 300;
      margin-bottom: 5px;
    }
    
    .coords {
      color: rgba(255,255,255,0.6);
      font-size: 12px;
      margin-bottom: 20px;
    }
    
    .main-temp {
      font-size: 72px;
      font-weight: 200;
      line-height: 1;
      margin-bottom: 10px;
    }
    
    .weather-desc {
      font-size: 20px;
      text-transform: capitalize;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .weather-icon { font-size: 48px; }
    
    /* Grille de donn√©es d√©taill√©es */
    .details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .detail-card {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 15px;
      text-align: center;
    }
    
    .detail-label {
      font-size: 12px;
      color: rgba(255,255,255,0.6);
      text-transform: uppercase;
      margin-bottom: 5px;
    }
    
    .detail-value {
      font-size: 24px;
      font-weight: 600;
    }
    
    /* Pr√©visions 7 jours */
    .forecast-title {
      font-size: 18px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    
    .forecast-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .forecast-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      transition: background 0.3s;
    }
    
    .forecast-item:hover { background: rgba(255,255,255,0.15); }
    
    /* Contr√¥les de couche (style Meteologix) */
    .layer-controls {
      position: absolute;
      top: 100px;
      left: 20px;
      background: rgba(0,0,0,0.7);
      padding: 15px;
      border-radius: 15px;
      z-index: 500;
    }
    
    .layer-btn {
      display: block;
      width: 100%;
      padding: 10px 15px;
      margin-bottom: 8px;
      background: rgba(255,255,255,0.1);
      border: 2px solid transparent;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .layer-btn:hover { background: rgba(255,255,255,0.2); }
    .layer-btn.active { border-color: #4CAF50; background: rgba(76,175,80,0.3); }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
      .container { grid-template-columns: 1fr; grid-template-rows: 50vh auto; }
      #map { height: 50vh; }
      .weather-panel { max-height: 50vh; }
      .layer-controls { top: auto; bottom: 20px; right: 20px; left: auto; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <input type="text" class="search-box" placeholder="Rechercher une ville..." id="searchInput">
    <button class="btn-location" onclick="getLocation()" title="Ma position">üìç</button>
  </div>
  
  <div class="container">
    <!-- Carte interactive -->
    <div id="map"></div>
    
    <!-- Contr√¥les de couche -->
    <div class="layer-controls">
      <button class="layer-btn active" onclick="setLayer('temp')">üå°Ô∏è Temp√©rature</button>
      <button class="layer-btn" onclick="setLayer('rain')">üåßÔ∏è Pr√©cipitations</button>
      <button class="layer-btn" onclick="setLayer('wind')">üí® Vent</button>
      <button class="layer-btn" onclick="setLayer('clouds')">‚òÅÔ∏è Nuages</button>
    </div>
    
    <!-- Panneau m√©t√©o -->
    <div class="weather-panel">
      <h1 class="city-name" id="cityName">Paris</h1>
      <div class="coords" id="coords">48.8566¬∞N, 2.3522¬∞E</div>
      
      <div class="main-temp" id="temperature">12¬∞</div>
      <div class="weather-desc">
        <span class="weather-icon" id="weatherIcon">‚òÄÔ∏è</span>
        <span id="description">Ensoleill√©</span>
      </div>
      
      <div class="details-grid">
        <div class="detail-card">
          <div class="detail-label">Vent</div>
          <div class="detail-value" id="wind">15 <small>km/h</small></div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Humidit√©</div>
          <div class="detail-value" id="humidity">65<small>%</small></div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Pression</div>
          <div class="detail-value" id="pressure">1013 <small>hPa</small></div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Visibilit√©</div>
          <div class="detail-value" id="visibility">10 <small>km</small></div>
        </div>
      </div>
      
      <h3 class="forecast-title">üìÖ Pr√©visions 7 jours</h3>
      <div class="forecast-list" id="forecastList">
        <!-- G√©n√©r√© par JS -->
      </div>
      
      <div style="margin-top: 20px; text-align: center; color: rgba(255,255,255,0.5); font-size: 12px;">
        Donn√©es Open-Meteo ‚Ä¢ Cliquez sur la carte pour changer de position
      </div>
    </div>
  </div>

  <script>
    // Initialisation de la carte
    const map = L.map('map').setView([48.8566, 2.3522], 6);
    
    // Fond de carte (plusieurs options)
    const baseLayers = {
      'Carte': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
      'Satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'),
      'Relief': L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png')
    };
    
    baseLayers['Carte'].addTo(map);
    
    // Marqueur draggable
    let marker = L.marker([48.8566, 2.3522], {draggable: true}).addTo(map);
    
    marker.on('dragend', function(e) {
      const pos = e.target.getLatLng();
      fetchWeather(pos.lat, pos.lng);
    });
    
    // Clic sur la carte
    map.on('click', function(e) {
      marker.setLatLng(e.latlng);
      fetchWeather(e.latlng.lat, e.latlng.lng);
    });
    
    // G√©olocalisation
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            map.setView([latitude, longitude], 10);
            marker.setLatLng([latitude, longitude]);
            fetchWeather(latitude, longitude);
          },
          (error) => {
            alert('Impossible d\'obtenir votre position. V√©rifiez vos permissions.');
          }
        );
      }
    }
    
    // Recherche de ville (g√©ocodage simple)
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchCity(this.value);
      }
    });
    
    async function searchCity(query) {
      try {
        const response = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1&language=fr&format=json`);
        const data = await response.json();
        
        if (data.results && data.results.length > 0) {
          const city = data.results[0];
          map.setView([city.latitude, city.longitude], 10);
          marker.setLatLng([city.latitude, city.longitude]);
          fetchWeather(city.latitude, city.longitude);
        } else {
          alert('Ville non trouv√©e');
        }
      } catch (error) {
        console.error('Erreur de recherche:', error);
      }
    }
    
    // R√©cup√©ration des donn√©es m√©t√©o
    async function fetchWeather(lat, lon) {
      try {
        // M√©t√©o actuelle
        const currentUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m,surface_pressure,visibility&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`;
        
        const response = await fetch(currentUrl);
        const data = await response.json();
        
        updateUI(data, lat, lon);
      } catch (error) {
        console.error('Erreur m√©t√©o:', error);
      }
    }
    
    function updateUI(data, lat, lon) {
      const current = data.current;
      const daily = data.daily;
      
      // Mise √† jour des coordonn√©es
      document.getElementById('coords').textContent = `${lat.toFixed(4)}¬∞N, ${lon.toFixed(4)}¬∞E`;
      
      // Temp√©rature et description
      document.getElementById('temperature').textContent = `${Math.round(current.temperature_2m)}¬∞`;
      document.getElementById('description').textContent = getWeatherDescription(current.weather_code);
      document.getElementById('weatherIcon').textContent = getWeatherIcon(current.weather_code);
      
      // D√©tails
      document.getElementById('wind').innerHTML = `${current.wind_speed_10m} <small>km/h</small>`;
      document.getElementById('humidity').innerHTML = `${current.relative_humidity_2m}<small>%</small>`;
      document.getElementById('pressure').innerHTML = `${Math.round(current.surface_pressure)} <small>hPa</small>`;
      document.getElementById('visibility').innerHTML = `${(current.visibility / 1000).toFixed(1)} <small>km</small>`;
      
      // Pr√©visions 7 jours
      const forecastList = document.getElementById('forecastList');
      forecastList.innerHTML = '';
      
      const jours = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
      
      for (let i = 0; i < 7; i++) {
        const date = new Date();
        date.setDate(date.getDate() + i);
        const jourNom = i === 0 ? 'Aujourd\'hui' : jours[date.getDay()];
        
        const min = Math.round(daily.temperature_2m_min[i]);
        const max = Math.round(daily.temperature_2m_max[i]);
        const code = daily.weather_code[i];
        
        const item = document.createElement('div');
        item.className = 'forecast-item';
        item.innerHTML = `
          <span style="width: 80px;">${jourNom}</span>
          <span style="font-size: 20px;">${getWeatherIcon(code)}</span>
          <span style="flex: 1; text-align: center;">
            <span style="opacity: 0.7;">${min}¬∞</span> / <strong>${max}¬∞</strong>
          </span>
        `;
        forecastList.appendChild(item);
      }
    }
    
    // Codes m√©t√©o Open-Meteo vers texte/ic√¥nes
    function getWeatherDescription(code) {
      const codes = {
        0: 'Ciel d√©gag√©', 1: 'Principalement d√©gag√©', 2: 'Partiellement nuageux',
        3: 'Nuageux', 45: 'Brouillard', 48: 'Brouillard givrant',
        51: 'Bruine l√©g√®re', 53: 'Bruine mod√©r√©e', 55: 'Bruine dense',
        61: 'Pluie l√©g√®re', 63: 'Pluie mod√©r√©e', 65: 'Pluie forte',
        71: 'Neige l√©g√®re', 73: 'Neige mod√©r√©e', 75: 'Neige forte',
        95: 'Orage', 96: 'Orage avec gr√™le'
      };
      return codes[code] || 'Inconnu';
    }
    
    function getWeatherIcon(code) {
      if (code === 0 || code === 1) return '‚òÄÔ∏è';
      if (code === 2) return '‚õÖ';
      if (code === 3) return '‚òÅÔ∏è';
      if (code <= 48) return 'üå´Ô∏è';
      if (code <= 55) return 'üå¶Ô∏è';
      if (code <= 65) return 'üåßÔ∏è';
      if (code <= 77) return '‚ùÑÔ∏è';
      if (code <= 82) return 'üå¶Ô∏è';
      if (code <= 86) return '‚ùÑÔ∏è';
      return '‚õàÔ∏è';
    }
    
    function setLayer(type) {
      document.querySelectorAll('.layer-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      // Ici: changer la couche de la carte selon le type
    }
    
    // Chargement initial
    fetchWeather(48.8566, 2.3522);
  </script>
</body>
</html>
